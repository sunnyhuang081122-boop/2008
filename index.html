<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// ğŸ” æ›æˆä½ è‡ªå·±çš„
const SUPABASE_URL = "ä½ çš„ supabase url";
const SUPABASE_KEY = "ä½ çš„ anon key";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// DOM
const input = document.getElementById("nickname");
const joinBtn = document.getElementById("joinBtn");
const queueList = document.getElementById("queueList");

// æ–°å¢æ’å–®
joinBtn.addEventListener("click", async () => {
  const nickname = input.value.trim();
  if (!nickname) return alert("è«‹è¼¸å…¥æš±ç¨±");

  await supabase.from("queue").insert([
    { nickname, status: "pending" }
  ]);

  input.value = "";
  loadQueue();
});

// è®€å–ä¸¦æ¸²æŸ“æ’å–®
async function loadQueue() {
  const { data, error } = await supabase
    .from("queue")
    .select("*")
    .order("created_at", { ascending: true });

  if (error) {
    console.error(error);
    return;
  }

  queueList.innerHTML = "";

  const approved = data.filter(d => d.status === "approved");
  const pending = data.filter(d => d.status === "pending");

  // å·²é€šéï¼ˆæœ‰é †ä½ï¼‰
  approved.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "queue-item approved";
    div.innerHTML = `
      <span class="order">ç¬¬ ${index + 1} ä½</span>
      <span class="name">${item.nickname}</span>
    `;
    queueList.appendChild(div);
  });

  // å¾…å¯©æ ¸ï¼ˆåœ¨æœ€ä¸‹é¢ï¼‰
  pending.forEach(item => {
    const div = document.createElement("div");
    div.className = "queue-item pending";
    div.innerHTML = `
      <span class="name">${item.nickname}</span>
      <span class="tag">å¾…å¯©æ ¸</span>
    `;
    queueList.appendChild(div);
  });
}

// åˆå§‹è¼‰å…¥
loadQueue();
</script>

